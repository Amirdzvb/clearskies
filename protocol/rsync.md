Rsync Extension
---------------

This is an optional protocol feature.  The official feature string is "rsync".
Feature negotiation is covered in the core protocol documentation.

The rsync extension increases wire efficiency by only transferring the parts of
files that have changed.

The behavior of the algorithm works similar to the "rdiff" command available
for unix, where the "signature", "delta", and "patch" steps are done separately.

For file transfer, if a local file is already present and a delta is desired,
instead of issuing a "get" request, a "rsync.signature" request with a binary
payload can be sent:

```json
{
  "type": "rsync.signature",
  "path": "photos/img1.jpg"
}
```

The peer then responds with an "rsync.patch" message, with a binary payload of
the actual patch generated by the "delta" command:

```json
{
  "type": "rsync.patch",
  "path": "photos/img1.jpg"
}
```

The software then uses the patch and the old file to create a temporary file,
which is then used to overwrite the old file after verification of the SHA256
sum, as normal.

Since the encryption key for a file never changes, untrusted peers can also
implement the above messages.  The "path" should be replaced with the "file_id"
in this case.


Rsync Tree Extension
-----------------------

This is an optional protocol feature.  The official feature string is
"rsync_tree".  Feature negotiation is covered in the core protocol
documentation.

The rsync algorithm can also be used to reduce the amount of bandwidth
necessary for the manifest exchange.

Since JSON does not guarantee the order of keys, some JSON libraries may give
different results for the same input.  Implementations that want to support the
"rsync_tree" extension should switch libraries if this is the case.

In order to implement this extension the latest manifest for each peer will
need to be saved to disk, even for read-write nodes.

Instead of sending the "get_manifest" message, a "rsync_tree.signature" message
should be sent instead.  The signature should be the binary payload of the
message.

```json
{
  "type": "rsync_tree.signature"
}
```

The peer will respond with a patch message.  If the peer is read-write, it will
include an RSA signature for the manifest after the manifest, separated by a
newline.  The binary payload contains the actual patch.

```json
{
  "type": "rsync_tree.patch"
}
```

The patch is then applied to the old manifest to create a new manifest.
